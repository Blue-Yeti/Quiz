<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinguoFocus - Standalone Learner</title>
    <!-- CSS is safe to load via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <!-- Essential Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        
        // Custom Icon handler to ensure Lucide works locally
        const Icon = ({ name, size = 24, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (window.lucide && ref.current) {
                    const icon = window.lucide.icons[name];
                    if (icon) {
                        const svg = icon.toSvg({ 
                            width: size, 
                            height: size, 
                            class: className,
                            'stroke-width': 3
                        });
                        ref.current.innerHTML = svg;
                    }
                }
            }, [name, size, className]);
            return <span ref={ref} className="inline-flex items-center justify-center" />;
        };

        const VOCABULARY = [
            { id: 1, word: "The Apple", translation: "La Manzana", image: "https://images.unsplash.com/photo-1560806887-1e4cd0b6bcd6?w=800&auto=format&fit=crop", audio: "https://actions.google.com/sounds/v1/foley/crunchy_bite.ogg" },
            { id: 2, word: "The Ocean", translation: "El Océano", image: "https://images.unsplash.com/photo-1505118380757-91f5f45d8de4?w=800&auto=format&fit=crop", audio: "https://actions.google.com/sounds/v1/water/waves_crashing_on_rock.ogg" },
            { id: 3, word: "The Mountain", translation: "La Montaña", image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800&auto=format&fit=crop", audio: "https://actions.google.com/sounds/v1/weather/wind_heavy_cold.ogg" },
            { id: 4, word: "The Book", translation: "El Libro", image: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?w=800&auto=format&fit=crop", audio: "https://actions.google.com/sounds/v1/office/paper_shuffle.ogg" },
            { id: 5, word: "The Forest", translation: "El Bosque", image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&auto=format&fit=crop", audio: "https://actions.google.com/sounds/v1/foley/forest_ambience.ogg" },
            { id: 6, word: "The Sun", translation: "El Sol", image: "https://images.unsplash.com/photo-1529693662653-9d480530a697?w=800&auto=format&fit=crop", audio: "https://actions.google.com/sounds/v1/weather/sunny_day_ambience.ogg" },
        ];

        const SUCCESS_SOUND = "https://actions.google.com/sounds/v1/buttons/button_interactive_notification.ogg";
        const ERROR_SOUND = "https://actions.google.com/sounds/v1/buttons/button_negative_feedback.ogg";

        const App = () => {
            const [view, setView] = useState('learn'); 
            const [currentIndex, setCurrentIndex] = useState(0);
            const [quizOptions, setQuizOptions] = useState([]);
            const [targetWord, setTargetWord] = useState(null);
            const [feedback, setFeedback] = useState(null); 
            const [score, setScore] = useState(0);

            const audioRef = useRef(new Audio());
            const feedbackAudioRef = useRef(new Audio());

            const playSound = useCallback((url) => {
                if (!url) return;
                audioRef.current.pause();
                audioRef.current.src = url;
                audioRef.current.play().catch(e => console.log("Audio play blocked", e));
            }, []);

            const playFeedback = useCallback((url) => {
                feedbackAudioRef.current.pause();
                feedbackAudioRef.current.src = url;
                feedbackAudioRef.current.play().catch(e => console.log("Feedback blocked", e));
            }, []);

            const nextLearn = useCallback(() => {
                const nextIdx = (currentIndex + 1) % VOCABULARY.length;
                setCurrentIndex(nextIdx);
                setFeedback(null);
                playSound(VOCABULARY[nextIdx].audio);
            }, [currentIndex, playSound]);

            const prevLearn = useCallback(() => {
                const prevIdx = (currentIndex - 1 + VOCABULARY.length) % VOCABULARY.length;
                setCurrentIndex(prevIdx);
                setFeedback(null);
                playSound(VOCABULARY[prevIdx].audio);
            }, [currentIndex, playSound]);

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (view === 'learn') {
                        if (e.key === 'ArrowRight') nextLearn();
                        if (e.key === 'ArrowLeft') prevLearn();
                    }
                    if (e.key === ' ') {
                        e.preventDefault();
                        if (view === 'learn') playSound(VOCABULARY[currentIndex].audio);
                        if (view === 'quiz' && targetWord) playSound(targetWord.audio);
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [view, currentIndex, targetWord, nextLearn, prevLearn, playSound]);

            const setupQuiz = useCallback(() => {
                const shuffled = [...VOCABULARY].sort(() => 0.5 - Math.random());
                const selection = shuffled.slice(0, 6);
                const target = selection[Math.floor(Math.random() * selection.length)];
                setQuizOptions(selection);
                setTargetWord(target);
                setFeedback(null);
                setTimeout(() => playSound(target.audio), 400);
            }, [playSound]);

            useEffect(() => {
                if (view === 'quiz') setupQuiz();
                if (view === 'learn') playSound(VOCABULARY[currentIndex].audio);
            }, [view, setupQuiz]);

            const handleQuizSelection = (item) => {
                if (feedback) return;
                if (item.id === targetWord.id) {
                    setFeedback({ type: 'success' });
                    setScore(s => s + 1);
                    playFeedback(SUCCESS_SOUND);
                    setTimeout(() => setupQuiz(), 1500);
                } else {
                    setFeedback({ type: 'error' });
                    playFeedback(ERROR_SOUND);
                    setTimeout(() => setFeedback(null), 1000);
                }
            };

            const currentItem = VOCABULARY[currentIndex];

            return (
                <div className="min-h-screen flex flex-col select-none">
                    <header className="bg-white border-b border-slate-200 px-8 py-4 flex justify-between items-center shadow-sm">
                        <div className="flex items-center gap-3">
                            <div className="bg-indigo-600 p-2 rounded-xl text-white">
                                <Icon name="GraduationCap" size={24} />
                            </div>
                            <h1 className="text-xl font-black text-indigo-950 uppercase tracking-tight">LinguoFocus</h1>
                        </div>
                        <nav className="flex bg-slate-100 p-1 rounded-xl">
                            <button onClick={() => setView('learn')} className={`px-6 py-2 rounded-lg font-bold transition-all ${view === 'learn' ? 'bg-white shadow text-indigo-600' : 'text-slate-500'}`}>LEARN</button>
                            <button onClick={() => setView('quiz')} className={`px-6 py-2 rounded-lg font-bold transition-all ${view === 'quiz' ? 'bg-white shadow text-indigo-600' : 'text-slate-500'}`}>QUIZ</button>
                        </nav>
                    </header>

                    <main className="flex-grow p-6 flex flex-col items-center justify-center">
                        {view === 'learn' ? (
                            <div className="w-full max-w-4xl flex flex-col items-center">
                                <div className="bg-white rounded-[2rem] shadow-2xl overflow-hidden border border-slate-200 flex flex-col md:flex-row w-full min-h-[450px]">
                                    <div className="md:w-3/5 bg-slate-200">
                                        <img src={currentItem.image} className="w-full h-full object-cover" key={currentItem.id} />
                                    </div>
                                    <div className="md:w-2/5 p-10 flex flex-col justify-center items-center text-center">
                                        <h2 className="text-4xl font-black text-slate-900 mb-2">{currentItem.word}</h2>
                                        <p className="text-xl text-indigo-500 font-bold mb-8 italic">{currentItem.translation}</p>
                                        <button onClick={() => playSound(currentItem.audio)} className="w-20 h-20 bg-indigo-600 text-white rounded-full flex items-center justify-center hover:scale-110 active:scale-95 transition-all shadow-xl">
                                            <Icon name="Volume2" size={32} />
                                        </button>
                                    </div>
                                </div>
                                <div className="mt-10 flex items-center gap-8">
                                    <button onClick={prevLearn} className="p-4 bg-white rounded-2xl border-2 border-slate-200 text-slate-400 hover:text-indigo-600"><Icon name="ChevronLeft" size={32} /></button>
                                    <span className="font-black text-xl text-slate-400">{currentIndex + 1} / {VOCABULARY.length}</span>
                                    <button onClick={nextLearn} className="p-4 bg-indigo-600 rounded-2xl text-white shadow-lg"><Icon name="ChevronRight" size={32} /></button>
                                </div>
                            </div>
                        ) : (
                            <div className="w-full max-w-5xl">
                                <div className="flex justify-between items-center mb-8 bg-white p-6 rounded-2xl shadow-sm">
                                    <h2 className="text-xl font-black uppercase text-slate-700">Listen & Find the Image</h2>
                                    <div className="text-right">
                                        <span className="text-xs font-bold text-slate-400 uppercase block">Total Score</span>
                                        <span className="text-3xl font-black text-indigo-600">{score}</span>
                                    </div>
                                </div>
                                <div className="flex justify-center mb-10">
                                    <button onClick={() => playSound(targetWord?.audio)} className="flex items-center gap-4 bg-white border-4 border-indigo-600 text-indigo-600 p-8 rounded-3xl hover:bg-indigo-50 transition-all shadow-xl">
                                        <Icon name="Volume2" size={48} />
                                        <span className="text-xl font-black uppercase">Play Audio (Space)</span>
                                    </button>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                    {quizOptions.map((item) => (
                                        <button key={item.id} onClick={() => handleQuizSelection(item)} className={`relative aspect-video rounded-3xl overflow-hidden border-4 transition-all ${feedback?.type === 'success' && item.id === targetWord.id ? 'border-green-500 scale-105 shadow-2xl' : feedback?.type === 'error' && item.id !== targetWord.id ? 'opacity-30 grayscale' : 'border-white hover:border-indigo-400 bg-white shadow-lg'}`}>
                                            <img src={item.image} className="w-full h-full object-cover" />
                                            {feedback?.type === 'success' && item.id === targetWord.id && (
                                                <div className="absolute inset-0 bg-green-500/20 flex items-center justify-center backdrop-blur-sm">
                                                    <div className="bg-white p-4 rounded-full text-green-600 shadow-xl"><Icon name="CheckCircle2" size={48} /></div>
                                                </div>
                                            )}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>
                    <footer className="p-6 text-center text-[10px] font-bold text-slate-400 tracking-[0.3em] uppercase">
                        Left/Right Arrows to Navigate • Spacebar to Replay Audio
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
